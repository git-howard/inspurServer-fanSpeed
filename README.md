# IPMI 风扇控制程序

这是一个用于控制服务器IPMI风扇转速的Python程序，支持自动模式、手动模式以及根据中国节假日和周末自动选择执行模式的功能。

## 功能特点

- 支持手动设置风扇转速（0-100%）
- 支持自动模式（auto）
- 根据中国节假日和周末自动选择执行模式
- 联网获取最新的中国节假日数据
- 支持多服务器配置
- 详细的日志记录
- 友好的错误处理

## 安装要求

- Python 3.6+
- requests 库

可以通过以下命令安装依赖：
```
pip install requests
```

## 配置文件

程序使用 `fanSpeed.json` 作为配置文件，格式如下：

```json
[
    {
        "description": "服务器描述",
        "bmc_host": "服务器IP地址",
        "username": "BMC用户名",
        "password": "BMC密码",
        "fans_count": 风扇数量,
        "fan_speed": 默认转速（0-100）
    }
]
```

### 配置项说明

- `description`: 服务器描述信息（可选）
- `bmc_host`: 服务器的BMC IP地址（必需）
- `username`: BMC登录用户名（必需）
- `password`: BMC登录密码（必需）
- `fans_count`: 服务器风扇数量（必需）
- `fan_speed`: 默认风扇转速，0-100之间的整数（可选，用于自动模式选择）

## 使用方法

### 基本用法

```bash
# 不带参数运行，程序将根据日期自动选择执行模式
python fanSpeed.py

# 手动设置风扇转速为50%
python fanSpeed.py 50

# 设置为自动模式
python fanSpeed.py auto
```

### 自动模式选择逻辑

当不指定参数运行程序时，将按照以下逻辑自动选择执行模式：

1. 程序首先联网获取最新的中国节假日数据
2. 如果当前日期是周末或中国节假日，则执行auto模式
3. 如果当前日期是工作日，则使用配置文件中的fan_speed值设置风扇转速

### 日志文件

程序运行时会生成 `fan_control.log` 日志文件，记录所有操作和状态信息。

## 节假日数据

程序使用免费的节假日API（https://tool.bitefu.net/jiari/）获取最新的中国节假日数据。如果API调用失败，程序会使用内置的节假日列表作为备用。

### 内置节假日列表

程序内置了以下中国节假日：

- 元旦：1月1日-1月3日
- 春节：2月10日-2月14日
- 清明节：4月4日-4月5日
- 劳动节：5月1日-5月3日
- 端午节：6月10日
- 国庆节：10月1日-10月5日

## 注意事项

1. 确保服务器BMC接口可访问
2. 确保配置文件中的用户名和密码正确
3. 程序运行时会忽略SSL证书验证警告
4. 如果API调用失败，程序会使用内置的节假日列表，但可能不是最新的

## 示例输出

```
2025-10-04 21:33:02,851 - INFO - 正在检查节假日状态...
2025-10-04 21:33:02,967 - INFO - 通过API确认 2025-10-04 是周末
2025-10-04 21:33:02,969 - INFO - 当前是周末或中国节假日，自动执行auto模式
2025-10-04 21:33:02,970 - INFO - 
===== 执行配置 1/1 - ESXi-2 服务器 =====
2025-10-04 21:33:05,057 - INFO - 登录成功
2025-10-04 21:33:05,136 - INFO - 设置风扇模式为：auto
2025-10-04 21:33:05,137 - INFO - 服务器 192.168.1.22 的风扇已设置为自动模式
```

## 故障排除

如果程序运行出现问题，请检查：

1. 网络连接是否正常
2. 服务器BMC接口是否可访问
3. 配置文件是否正确
4. 日志文件中的错误信息

## 许可证

本项目采用MIT许可证。